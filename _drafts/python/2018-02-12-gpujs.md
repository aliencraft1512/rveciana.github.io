---
layout: post
title:  gpu.js
date:   2018-02-03
teaser: gpujs-mapping.png
categories: other
tags: [GPU, gpujs, canvas]
thumbnail: /images/other/gpujs-mapping/twitter.png
twitter-card: summary
description: Use the GPU to calculate and draw data layers
---

[gpu.js][1] is a JavaScript Acceleration library for [GPGPU (General purpose computing on GPUs)][2] in Javascript. This means, basically, using the GPU instead of the CPU for the calculations, and coding in simple JavaScript.

The library is awesome, but I found some issues trying to run my things, so I will try to put all my steps here, which will help me in first place.

Including the library
---------------------

From a regular web page, just include:

{% highlight js %}
<script src="/path/to/js/gpu.min.js"></script>
{% endhighlight %}

then, initialize the library calling

{% highlight js %}
const gpu = new GPU();
{% endhighlight %}

It's possible to pass to the GPU constructor the options:

    {mode: 'gpu'} or {mode: 'cpu'}

Setting it forces the use of the CPU, which can be nice for performance comparison.

### ObservableHQ

[ObservableHQ][3] is a new and awesome site to publish interactive examples. Requiring libraries is possible, but they have to be in UMD or AMD, which is not the case of [gpu.js][1]. A working solution is using the [wzrd][4] service

{% highlight js %}
GPU = require('https://wzrd.in/standalone/gpu.js')
{% endhighlight %}

First working example
---------------------

The [gpu.js docs][1] come with a first example, which is a matrix multiplication. The example is correct, but without all the code. Here's a working example ([I took the source here][5]):

{% highlight js %}
var GPU = require("gpu.js");

var gpu = new GPU();

var matMult = gpu.createKernel(function(a, b) {
    var sum = 0;
    for (var i = 0; i < 512; i++) {
        sum += a[this.thread.y][i] * b[i][this.thread.x];
    }
    return sum;
}).setOutput([512, 512]);

function generateMatrices() {
    let matSize = 512;
    let A = [];
    let B = [];
    for (let n = 0; n < matSize * matSize; n++) {
        const randA = Math.random();
        const randB = Math.random();
        A.push(randA);
        B.push(randB);
    }

    A = splitArray(A, matSize);
    B = splitArray(B, matSize);

    function splitArray(array, part) {
        var tmp = [];
        for (var i = 0; i < array.length; i += part) {
            tmp.push(array.slice(i, i + part));
        }
        return tmp;
    }
    return {
        A,
        B
    };
}

let matrices = generateMatrices();
var c = matMult(matrices.A, matrices.B);
{% endhighlight %}

Links
-----

* [The gpu.js web site][1]
* [GPGPU Wikipedia page][2]
* [ObservableHQ][3]
* [wzrd.in][4]
* [generateMatrices source][5]

[1]: http://gpu.rocks
[2]: https://en.wikipedia.org/wiki/General-purpose_computing_on_graphics_processing_units
[3]: https://observablehq.com
[4]: https://wzrd.in/
[5]: https://gist.github.com/abhisheksoni27/b4ef97bed87d337b2c0ed06791fd3dcb
